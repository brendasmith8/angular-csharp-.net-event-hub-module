@page "/events/{url}"
@inject IHtmlLocalizer<EventHubResource> L
@using EventHub.Localization
@using EventHub.Web.Helpers
@using EventHub.Web.Pages.Events
@using EventHub.Web.Pages.Events.Components.AttendeesArea
@using EventHub.Web.Pages.Events.Components.EventsArea
@using EventHub.Web.Pages.Events.Components.LocationArea
@using EventHub.Web.Pages.Events.Components.RegistrationArea
@using Microsoft.AspNetCore.Mvc.Localization
@using Volo.Abp.Timing
@using Volo.Abp.Users
@inject ICurrentUser CurrentUser
@inject IClock Clock
@model EventHub.Web.Pages.Events.DetailPageModel
<div class="bg-white py-5">
    <div class="container detail-page pb-4">
        <div class="row">
            <div class="col-md-7">
                <div class="detail-image">
                    @if (Model.Event.CoverImageContent == null)
                    {
                        <div class="rounded detail-span text-center" style="background: @(CoverImageHelper.GetRandomColor(Model.Event.Title))">
                            <span>
                                @CoverImageHelper.GetContentOfImage(Model.Event.Title.TruncateWithPostfix(70))
                                <br>
                                @CoverImageHelper.GetContentOfImage(Model.Event.OrganizationDisplayName.TruncateWithPostfix(80))
                                <br>
                                @CoverImageHelper.GetContentOfImage(EventDateHelper.GetDateRangeText(Model.Event.StartTime, Model.Event.EndTime))
                            </span>
                        </div>
                    }
                    else
                    {
                        <img src="@($"data:image/png;base64,{Convert.ToBase64String(Model.Event.CoverImageContent)}")" alt="@Model.Event.Title">
                    }
                </div>
            </div>

            <div class="col-md-5 pl-md-5">
                <h1 class="mt-4 mt-md-0">@Model.Event.Title</h1>
                @await Component.InvokeAsync(typeof(LocationAreaViewComponent), new {eventId = Model.Event.Id})

                <h5 class="detail-head mt-4">Owner</h5>
                <div>
                    <a href="/users/@Model.Event.OwnerUserName">
                        <img gravatar-email="@Model.Event.OwnerEmail" default-image="Wavatar" gravatar-size="40" class="org-avatar avatar rounded-circle" data-toggle="tooltip" title="@Model.Event.OwnerUserName"/>
                    </a>
                </div>
                @if (Model.IsEventOwner)
                {
                    <a href="/event/edit/@Model.Event.Url" class="btn btn-primary mt-4 text-white">
                        <i class="far fa-edit"></i> Edit
                    </a>
                }
                @await Component.InvokeAsync(typeof(RegistrationAreaViewComponent), new {eventId = Model.Event.Id})
            </div>
        </div>
        <div class="row">
            <div class="col-md-7">
                <h5 class="detail-head mt-5 font-weight-bold">Event Description</h5>
                <p>
                    @Model.Event.Description
                </p>

                <h5 class="detail-head mt-5 font-weight-bold">Date</h5>
                <p>
                    @EventDateHelper.GetDateRangeText(Model.Event.StartTime, Model.Event.EndTime)
                </p>
                @await Component.InvokeAsync(typeof(AttendeesAreaViewComponent), new {eventId = Model.Event.Id})
            </div>
        </div>
    </div>
</div>


<div class="container pt-5">
    <div class="row py-4">
        <div class="col-md">
            <h2>Events You Will Enjoy</h2>
        </div>
    </div>

    @await Component.InvokeAsync(typeof(EventsAreaViewComponent), new
    {
        minDate = Clock.Now.ClearTime(),
        MaxResultCount = 6,
        isPagination = false
    })
</div>