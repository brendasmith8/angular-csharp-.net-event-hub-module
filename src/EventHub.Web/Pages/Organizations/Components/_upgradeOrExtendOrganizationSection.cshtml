@using EventHub.Organizations
@model EventHub.Organizations.OrganizationProfileDto
@inject IOrganizationAppService OrganizationAppService

@{
    var premiumPlanInfo = (await OrganizationAppService.GetPlanInfosAsync()).MaxBy(x => x.Price)!;
}

<abp-container class="mt-4">
    <abp-row>
        @if (Model.IsPremium && premiumPlanInfo.IsActive && premiumPlanInfo.IsExtendable && Model.PremiumEndDate!.Value.IsBetween(DateTime.Now, DateTime.Now.AddMonths(premiumPlanInfo.OnePremiumPeriodAsMonth!.Value - premiumPlanInfo.CanBeExtendedAfterHowManyMonths!.Value)))
        {
            <span class="mb-2 ms-5 text-center strong">Premium end date: @Model.PremiumEndDate!.Value.ToShortDateString()</span>
        }
        <abp-column>
            <a href="/organization/edit/@Model.Name" class="btn btn-success text-white">Edit</a>
        </abp-column>
        <abp-column size="_9">
            @if (premiumPlanInfo.IsActive)
            {
                @if (Model.IsPremium)
                {
                    @if (premiumPlanInfo.IsExtendable && Model.PremiumEndDate!.Value.IsBetween(DateTime.Now, DateTime.Now.AddMonths(premiumPlanInfo.OnePremiumPeriodAsMonth!.Value - premiumPlanInfo.CanBeExtendedAfterHowManyMonths!.Value)))
                    {
                        <div class="d-grid gap-2">
                            <a href="@Url.Page("/Pricing", new { organizationName = Model.Name })" class="btn btn-info">
                                <i class="fas fa-crown me-2"></i> Extend Now
                            </a>
                        </div>
                    }
                    else
                    {
                        <div class="d-grid gap-2">
                            <button class="btn btn-info">
                                <span class="mt-2">Premium end date: @Model.PremiumEndDate!.Value.ToShortDateString()</span>
                            </button>
                        </div>
                    }
                }
                else
                {
                    <div class="d-grid gap-2">
                        <a href="@Url.Page("/Pricing", new { organizationName = Model.Name })" class="btn btn-info">
                            <i class="fas fa-crown me-2"></i> Upgrade To @premiumPlanInfo.PlanType
                        </a>
                    </div>
                }
            }
            else
            {
                <abp-card class="text-center">
                    <abp-card-body>
                        <span>Premium end date: @Model.PremiumEndDate!.Value.ToShortDateString()</span>
                    </abp-card-body>
                </abp-card>
            }
        </abp-column>
    </abp-row>
</abp-container>
